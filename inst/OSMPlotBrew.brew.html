<head>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
	<!--[if lte IE 8]>
	    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
	<![endif]-->

	<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>

	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

	

</head>

<body>
	<div id="map"></div>


	<script>


		var geoJSONSet = theRgeneratedgeoJSON;

		var map;
		var ajaxRequest;
		var plotlist;
		var plotlayers=[];

		$(document).ready(function(){
			$('#map').height($(window).height()-20);
	  		$('#map').width($(window).width()-20);
			initmap();
		});

		$(window).resize(function(){
			$('#map').val('');
			$('#map').height($(window).height()-20);
	  		$('#map').width($(window).width()-20);
			initmap();
		});
		function initmap() {
			// set up the map
			map = new L.Map('map');

			// create the tile layer with correct attribution
			var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
			var osmAttrib='Map data Â© OpenStreetMap contributors';
			var osm = new L.TileLayer(osmUrl, {minZoom: 0, maxZoom: 19, attribution: osmAttrib});		

			// start the map in South-East England
			map.setView(new L.LatLng(mapCenterLat, mapCenterLong), mapZoomLevel);
			map.addLayer(osm);	

			var layers={};
			$.each(geoJSONSet, function(i, item){
				//add the geo points
				layers[item.layer]=L.geoJson(item.data, {

					onEachFeature: function(feature, layer){
						
						switch (feature.geometry.type){
							case "Point": 
							(function(){
								return L.circleMarker(feature.geometry.coordinates, {
									radius: feature.properties.size,
									fillColor: feature.properties.color,
									color: "#000",
									weight: 1,
									opacity: 1,
									fillOpacity: 0.8			
								}).bindPopup(feature.properties.popupContent);
							})();
							break;
							case "LineString": 
							(function(){
								return L.polyline(feature.geometry.coordinates, {
									color: feature.properties.color
								});
							})(); 
							break;
						}
					}

				});
				
			});
			//add the layers to the map
			
			L.control.layers(null, layers).addTo(map);
		}



	</script>
</body>